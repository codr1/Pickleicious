// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: open_play_enforcement.sql

package db

import (
	"context"
	"database/sql"
	"time"
)

const addReservationCourt = `-- name: AddReservationCourt :exec
INSERT INTO reservation_courts (reservation_id, court_id)
VALUES (?1, ?2)
`

type AddReservationCourtParams struct {
	ReservationID int64 `json:"reservationId"`
	CourtID       int64 `json:"courtId"`
}

func (q *Queries) AddReservationCourt(ctx context.Context, arg AddReservationCourtParams) error {
	_, err := q.exec(ctx, q.addReservationCourtStmt, addReservationCourt, arg.ReservationID, arg.CourtID)
	return err
}

const countReservationParticipants = `-- name: CountReservationParticipants :one
SELECT COUNT(*) FROM reservation_participants
WHERE reservation_id = ?1
`

func (q *Queries) CountReservationParticipants(ctx context.Context, reservationID int64) (int64, error) {
	row := q.queryRow(ctx, q.countReservationParticipantsStmt, countReservationParticipants, reservationID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const getOpenPlayReservationID = `-- name: GetOpenPlayReservationID :one
SELECT r.id
FROM reservations r
JOIN reservation_types rt ON rt.id = r.reservation_type_id
WHERE r.facility_id = ?1
  AND r.open_play_rule_id = ?2
  AND r.start_time = ?3
  AND r.end_time = ?4
  AND rt.name = 'OPEN_PLAY'
LIMIT 1
`

type GetOpenPlayReservationIDParams struct {
	FacilityID     int64         `json:"facilityId"`
	OpenPlayRuleID sql.NullInt64 `json:"openPlayRuleId"`
	StartTime      time.Time     `json:"startTime"`
	EndTime        time.Time     `json:"endTime"`
}

func (q *Queries) GetOpenPlayReservationID(ctx context.Context, arg GetOpenPlayReservationIDParams) (int64, error) {
	row := q.queryRow(ctx, q.getOpenPlayReservationIDStmt, getOpenPlayReservationID,
		arg.FacilityID,
		arg.OpenPlayRuleID,
		arg.StartTime,
		arg.EndTime,
	)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const listAvailableCourts = `-- name: ListAvailableCourts :many
SELECT c.id, c.court_number
FROM courts c
WHERE c.facility_id = ?1
  AND c.status = 'active'
  AND c.id NOT IN (
    SELECT rc.court_id
    FROM reservation_courts rc
    JOIN reservations r ON r.id = rc.reservation_id
    WHERE r.facility_id = ?1
      AND r.id != ?2
      AND r.start_time < ?3
      AND r.end_time > ?4
  )
ORDER BY c.court_number
`

type ListAvailableCourtsParams struct {
	FacilityID    int64     `json:"facilityId"`
	ReservationID int64     `json:"reservationId"`
	EndTime       time.Time `json:"endTime"`
	StartTime     time.Time `json:"startTime"`
}

type ListAvailableCourtsRow struct {
	ID          int64 `json:"id"`
	CourtNumber int64 `json:"courtNumber"`
}

func (q *Queries) ListAvailableCourts(ctx context.Context, arg ListAvailableCourtsParams) ([]ListAvailableCourtsRow, error) {
	rows, err := q.query(ctx, q.listAvailableCourtsStmt, listAvailableCourts,
		arg.FacilityID,
		arg.ReservationID,
		arg.EndTime,
		arg.StartTime,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListAvailableCourtsRow
	for rows.Next() {
		var i ListAvailableCourtsRow
		if err := rows.Scan(&i.ID, &i.CourtNumber); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listReservationCourts = `-- name: ListReservationCourts :many
SELECT rc.court_id, c.court_number
FROM reservation_courts rc
JOIN courts c ON c.id = rc.court_id
WHERE rc.reservation_id = ?1
ORDER BY c.court_number
`

type ListReservationCourtsRow struct {
	CourtID     int64 `json:"courtId"`
	CourtNumber int64 `json:"courtNumber"`
}

func (q *Queries) ListReservationCourts(ctx context.Context, reservationID int64) ([]ListReservationCourtsRow, error) {
	rows, err := q.query(ctx, q.listReservationCourtsStmt, listReservationCourts, reservationID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListReservationCourtsRow
	for rows.Next() {
		var i ListReservationCourtsRow
		if err := rows.Scan(&i.CourtID, &i.CourtNumber); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const removeReservationCourt = `-- name: RemoveReservationCourt :exec
DELETE FROM reservation_courts
WHERE reservation_id = ?1
  AND court_id = ?2
`

type RemoveReservationCourtParams struct {
	ReservationID int64 `json:"reservationId"`
	CourtID       int64 `json:"courtId"`
}

func (q *Queries) RemoveReservationCourt(ctx context.Context, arg RemoveReservationCourtParams) error {
	_, err := q.exec(ctx, q.removeReservationCourtStmt, removeReservationCourt, arg.ReservationID, arg.CourtID)
	return err
}
