// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: members.sql

package db

import (
	"context"
	"database/sql"
	"time"
)

const createMember = `-- name: CreateMember :execlastid
INSERT INTO users (
    first_name, last_name, email, phone,
    street_address, city, state, postal_code,
    status, date_of_birth, waiver_signed,
    is_member, membership_level
) VALUES (
    ?1, ?2, ?3, ?4,
    ?5, ?6, ?7, ?8,
    ?9,
    strftime('%Y-%m-%d', ?10),
    ?11,
    1, -- is_member = true
    ?12
)
`

type CreateMemberParams struct {
	FirstName       string         `json:"firstName"`
	LastName        string         `json:"lastName"`
	Email           sql.NullString `json:"email"`
	Phone           sql.NullString `json:"phone"`
	StreetAddress   sql.NullString `json:"streetAddress"`
	City            sql.NullString `json:"city"`
	State           sql.NullString `json:"state"`
	PostalCode      sql.NullString `json:"postalCode"`
	Status          string         `json:"status"`
	DateOfBirth     interface{}    `json:"dateOfBirth"`
	WaiverSigned    bool           `json:"waiverSigned"`
	MembershipLevel int64          `json:"membershipLevel"`
}

func (q *Queries) CreateMember(ctx context.Context, arg CreateMemberParams) (int64, error) {
	result, err := q.exec(ctx, q.createMemberStmt, createMember,
		arg.FirstName,
		arg.LastName,
		arg.Email,
		arg.Phone,
		arg.StreetAddress,
		arg.City,
		arg.State,
		arg.PostalCode,
		arg.Status,
		arg.DateOfBirth,
		arg.WaiverSigned,
		arg.MembershipLevel,
	)
	if err != nil {
		return 0, err
	}
	return result.LastInsertId()
}

const createPhoto = `-- name: CreatePhoto :one
INSERT INTO user_photos (user_id, data, content_type, size)
VALUES (?1, ?2, ?3, ?4)
RETURNING id
`

type CreatePhotoParams struct {
	UserID      int64  `json:"userId"`
	Data        []byte `json:"data"`
	ContentType string `json:"contentType"`
	Size        int64  `json:"size"`
}

func (q *Queries) CreatePhoto(ctx context.Context, arg CreatePhotoParams) (int64, error) {
	row := q.queryRow(ctx, q.createPhotoStmt, createPhoto,
		arg.UserID,
		arg.Data,
		arg.ContentType,
		arg.Size,
	)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const deleteMember = `-- name: DeleteMember :exec
UPDATE users
SET status = 'deleted',
    updated_at = CURRENT_TIMESTAMP
WHERE id = ?1 AND is_member = 1
`

func (q *Queries) DeleteMember(ctx context.Context, id int64) error {
	_, err := q.exec(ctx, q.deleteMemberStmt, deleteMember, id)
	return err
}

const deletePhoto = `-- name: DeletePhoto :exec
DELETE FROM user_photos
WHERE id = ?1
`

func (q *Queries) DeletePhoto(ctx context.Context, id int64) error {
	_, err := q.exec(ctx, q.deletePhotoStmt, deletePhoto, id)
	return err
}

const getCreatedMember = `-- name: GetCreatedMember :one
SELECT
    u.id, u.email, u.phone, u.cognito_sub, u.cognito_status, u.preferred_auth_method, u.password_hash, u.local_auth_enabled, u.first_name, u.last_name, u.photo_url, u.street_address, u.city, u.state, u.postal_code, u.home_facility_id, u.is_member, u.is_staff, u.date_of_birth, u.waiver_signed, u.membership_level, u.staff_role, u.status, u.created_at, u.updated_at,
    p.id as photo_id,
    ub.card_type,
    ub.card_last_four,
    ub.billing_address,
    ub.billing_city,
    ub.billing_state,
    ub.billing_postal_code
FROM users u
LEFT JOIN user_photos p ON p.user_id = u.id
LEFT JOIN user_billing ub ON ub.user_id = u.id
WHERE u.id = last_insert_rowid()
`

type GetCreatedMemberRow struct {
	ID                  int64          `json:"id"`
	Email               sql.NullString `json:"email"`
	Phone               sql.NullString `json:"phone"`
	CognitoSub          sql.NullString `json:"cognitoSub"`
	CognitoStatus       sql.NullString `json:"cognitoStatus"`
	PreferredAuthMethod sql.NullString `json:"preferredAuthMethod"`
	PasswordHash        sql.NullString `json:"passwordHash"`
	LocalAuthEnabled    bool           `json:"localAuthEnabled"`
	FirstName           string         `json:"firstName"`
	LastName            string         `json:"lastName"`
	PhotoUrl            sql.NullString `json:"photoUrl"`
	StreetAddress       sql.NullString `json:"streetAddress"`
	City                sql.NullString `json:"city"`
	State               sql.NullString `json:"state"`
	PostalCode          sql.NullString `json:"postalCode"`
	HomeFacilityID      sql.NullInt64  `json:"homeFacilityId"`
	IsMember            bool           `json:"isMember"`
	IsStaff             bool           `json:"isStaff"`
	DateOfBirth         string         `json:"dateOfBirth"`
	WaiverSigned        bool           `json:"waiverSigned"`
	MembershipLevel     int64          `json:"membershipLevel"`
	StaffRole           sql.NullString `json:"staffRole"`
	Status              string         `json:"status"`
	CreatedAt           time.Time      `json:"createdAt"`
	UpdatedAt           time.Time      `json:"updatedAt"`
	PhotoID             sql.NullInt64  `json:"photoId"`
	CardType            sql.NullString `json:"cardType"`
	CardLastFour        sql.NullString `json:"cardLastFour"`
	BillingAddress      sql.NullString `json:"billingAddress"`
	BillingCity         sql.NullString `json:"billingCity"`
	BillingState        sql.NullString `json:"billingState"`
	BillingPostalCode   sql.NullString `json:"billingPostalCode"`
}

func (q *Queries) GetCreatedMember(ctx context.Context) (GetCreatedMemberRow, error) {
	row := q.queryRow(ctx, q.getCreatedMemberStmt, getCreatedMember)
	var i GetCreatedMemberRow
	err := row.Scan(
		&i.ID,
		&i.Email,
		&i.Phone,
		&i.CognitoSub,
		&i.CognitoStatus,
		&i.PreferredAuthMethod,
		&i.PasswordHash,
		&i.LocalAuthEnabled,
		&i.FirstName,
		&i.LastName,
		&i.PhotoUrl,
		&i.StreetAddress,
		&i.City,
		&i.State,
		&i.PostalCode,
		&i.HomeFacilityID,
		&i.IsMember,
		&i.IsStaff,
		&i.DateOfBirth,
		&i.WaiverSigned,
		&i.MembershipLevel,
		&i.StaffRole,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PhotoID,
		&i.CardType,
		&i.CardLastFour,
		&i.BillingAddress,
		&i.BillingCity,
		&i.BillingState,
		&i.BillingPostalCode,
	)
	return i, err
}

const getMemberBilling = `-- name: GetMemberBilling :one
SELECT
    card_last_four,
    card_type,
    billing_address,
    billing_city,
    billing_state,
    billing_postal_code
FROM user_billing
WHERE user_id = ?1
`

type GetMemberBillingRow struct {
	CardLastFour      sql.NullString `json:"cardLastFour"`
	CardType          sql.NullString `json:"cardType"`
	BillingAddress    sql.NullString `json:"billingAddress"`
	BillingCity       sql.NullString `json:"billingCity"`
	BillingState      sql.NullString `json:"billingState"`
	BillingPostalCode sql.NullString `json:"billingPostalCode"`
}

func (q *Queries) GetMemberBilling(ctx context.Context, userID int64) (GetMemberBillingRow, error) {
	row := q.queryRow(ctx, q.getMemberBillingStmt, getMemberBilling, userID)
	var i GetMemberBillingRow
	err := row.Scan(
		&i.CardLastFour,
		&i.CardType,
		&i.BillingAddress,
		&i.BillingCity,
		&i.BillingState,
		&i.BillingPostalCode,
	)
	return i, err
}

const getMemberByEmail = `-- name: GetMemberByEmail :one
SELECT id, email, phone, cognito_sub, cognito_status, preferred_auth_method, password_hash, local_auth_enabled, first_name, last_name, photo_url, street_address, city, state, postal_code, home_facility_id, is_member, is_staff, date_of_birth, waiver_signed, membership_level, staff_role, status, created_at, updated_at FROM users
WHERE email = ?1 AND is_member = 1 AND status != 'deleted'
LIMIT 1
`

func (q *Queries) GetMemberByEmail(ctx context.Context, email sql.NullString) (User, error) {
	row := q.queryRow(ctx, q.getMemberByEmailStmt, getMemberByEmail, email)
	var i User
	err := row.Scan(
		&i.ID,
		&i.Email,
		&i.Phone,
		&i.CognitoSub,
		&i.CognitoStatus,
		&i.PreferredAuthMethod,
		&i.PasswordHash,
		&i.LocalAuthEnabled,
		&i.FirstName,
		&i.LastName,
		&i.PhotoUrl,
		&i.StreetAddress,
		&i.City,
		&i.State,
		&i.PostalCode,
		&i.HomeFacilityID,
		&i.IsMember,
		&i.IsStaff,
		&i.DateOfBirth,
		&i.WaiverSigned,
		&i.MembershipLevel,
		&i.StaffRole,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getMemberByEmailIncludeDeleted = `-- name: GetMemberByEmailIncludeDeleted :one
SELECT id, email, phone, cognito_sub, cognito_status, preferred_auth_method, password_hash, local_auth_enabled, first_name, last_name, photo_url, street_address, city, state, postal_code, home_facility_id, is_member, is_staff, date_of_birth, waiver_signed, membership_level, staff_role, status, created_at, updated_at FROM users
WHERE email = ?1
  AND email IS NOT NULL
  AND is_member = 1
LIMIT 1
`

func (q *Queries) GetMemberByEmailIncludeDeleted(ctx context.Context, email sql.NullString) (User, error) {
	row := q.queryRow(ctx, q.getMemberByEmailIncludeDeletedStmt, getMemberByEmailIncludeDeleted, email)
	var i User
	err := row.Scan(
		&i.ID,
		&i.Email,
		&i.Phone,
		&i.CognitoSub,
		&i.CognitoStatus,
		&i.PreferredAuthMethod,
		&i.PasswordHash,
		&i.LocalAuthEnabled,
		&i.FirstName,
		&i.LastName,
		&i.PhotoUrl,
		&i.StreetAddress,
		&i.City,
		&i.State,
		&i.PostalCode,
		&i.HomeFacilityID,
		&i.IsMember,
		&i.IsStaff,
		&i.DateOfBirth,
		&i.WaiverSigned,
		&i.MembershipLevel,
		&i.StaffRole,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getMemberByID = `-- name: GetMemberByID :one
SELECT
    u.id,
    u.first_name,
    u.last_name,
    u.email,
    u.phone,
    u.street_address,
    u.city,
    u.state,
    u.postal_code,
    u.status,
    u.date_of_birth,
    u.waiver_signed,
    u.membership_level,
    u.created_at,
    u.updated_at,
    up.id as photo_id
FROM users u
LEFT JOIN user_photos up ON up.user_id = u.id
WHERE u.id = ?1 AND u.is_member = 1 AND u.status != 'deleted'
`

type GetMemberByIDRow struct {
	ID              int64          `json:"id"`
	FirstName       string         `json:"firstName"`
	LastName        string         `json:"lastName"`
	Email           sql.NullString `json:"email"`
	Phone           sql.NullString `json:"phone"`
	StreetAddress   sql.NullString `json:"streetAddress"`
	City            sql.NullString `json:"city"`
	State           sql.NullString `json:"state"`
	PostalCode      sql.NullString `json:"postalCode"`
	Status          string         `json:"status"`
	DateOfBirth     string         `json:"dateOfBirth"`
	WaiverSigned    bool           `json:"waiverSigned"`
	MembershipLevel int64          `json:"membershipLevel"`
	CreatedAt       time.Time      `json:"createdAt"`
	UpdatedAt       time.Time      `json:"updatedAt"`
	PhotoID         sql.NullInt64  `json:"photoId"`
}

func (q *Queries) GetMemberByID(ctx context.Context, id int64) (GetMemberByIDRow, error) {
	row := q.queryRow(ctx, q.getMemberByIDStmt, getMemberByID, id)
	var i GetMemberByIDRow
	err := row.Scan(
		&i.ID,
		&i.FirstName,
		&i.LastName,
		&i.Email,
		&i.Phone,
		&i.StreetAddress,
		&i.City,
		&i.State,
		&i.PostalCode,
		&i.Status,
		&i.DateOfBirth,
		&i.WaiverSigned,
		&i.MembershipLevel,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PhotoID,
	)
	return i, err
}

const getMemberPhoto = `-- name: GetMemberPhoto :one
SELECT data, content_type
FROM user_photos
WHERE user_id = ?1
`

type GetMemberPhotoRow struct {
	Data        []byte `json:"data"`
	ContentType string `json:"contentType"`
}

func (q *Queries) GetMemberPhoto(ctx context.Context, userID int64) (GetMemberPhotoRow, error) {
	row := q.queryRow(ctx, q.getMemberPhotoStmt, getMemberPhoto, userID)
	var i GetMemberPhotoRow
	err := row.Scan(&i.Data, &i.ContentType)
	return i, err
}

const getPhoto = `-- name: GetPhoto :one
SELECT data, content_type
FROM user_photos
WHERE id = ?1
`

type GetPhotoRow struct {
	Data        []byte `json:"data"`
	ContentType string `json:"contentType"`
}

func (q *Queries) GetPhoto(ctx context.Context, id int64) (GetPhotoRow, error) {
	row := q.queryRow(ctx, q.getPhotoStmt, getPhoto, id)
	var i GetPhotoRow
	err := row.Scan(&i.Data, &i.ContentType)
	return i, err
}

const getRestoredMember = `-- name: GetRestoredMember :one
SELECT
    u.id, u.email, u.phone, u.cognito_sub, u.cognito_status, u.preferred_auth_method, u.password_hash, u.local_auth_enabled, u.first_name, u.last_name, u.photo_url, u.street_address, u.city, u.state, u.postal_code, u.home_facility_id, u.is_member, u.is_staff, u.date_of_birth, u.waiver_signed, u.membership_level, u.staff_role, u.status, u.created_at, u.updated_at,
    p.id as photo_id,
    ub.card_type,
    ub.card_last_four,
    ub.billing_address,
    ub.billing_city,
    ub.billing_state,
    ub.billing_postal_code
FROM users u
LEFT JOIN user_photos p ON p.user_id = u.id
LEFT JOIN user_billing ub ON ub.user_id = u.id
WHERE u.id = ?1
`

type GetRestoredMemberRow struct {
	ID                  int64          `json:"id"`
	Email               sql.NullString `json:"email"`
	Phone               sql.NullString `json:"phone"`
	CognitoSub          sql.NullString `json:"cognitoSub"`
	CognitoStatus       sql.NullString `json:"cognitoStatus"`
	PreferredAuthMethod sql.NullString `json:"preferredAuthMethod"`
	PasswordHash        sql.NullString `json:"passwordHash"`
	LocalAuthEnabled    bool           `json:"localAuthEnabled"`
	FirstName           string         `json:"firstName"`
	LastName            string         `json:"lastName"`
	PhotoUrl            sql.NullString `json:"photoUrl"`
	StreetAddress       sql.NullString `json:"streetAddress"`
	City                sql.NullString `json:"city"`
	State               sql.NullString `json:"state"`
	PostalCode          sql.NullString `json:"postalCode"`
	HomeFacilityID      sql.NullInt64  `json:"homeFacilityId"`
	IsMember            bool           `json:"isMember"`
	IsStaff             bool           `json:"isStaff"`
	DateOfBirth         string         `json:"dateOfBirth"`
	WaiverSigned        bool           `json:"waiverSigned"`
	MembershipLevel     int64          `json:"membershipLevel"`
	StaffRole           sql.NullString `json:"staffRole"`
	Status              string         `json:"status"`
	CreatedAt           time.Time      `json:"createdAt"`
	UpdatedAt           time.Time      `json:"updatedAt"`
	PhotoID             sql.NullInt64  `json:"photoId"`
	CardType            sql.NullString `json:"cardType"`
	CardLastFour        sql.NullString `json:"cardLastFour"`
	BillingAddress      sql.NullString `json:"billingAddress"`
	BillingCity         sql.NullString `json:"billingCity"`
	BillingState        sql.NullString `json:"billingState"`
	BillingPostalCode   sql.NullString `json:"billingPostalCode"`
}

func (q *Queries) GetRestoredMember(ctx context.Context, id int64) (GetRestoredMemberRow, error) {
	row := q.queryRow(ctx, q.getRestoredMemberStmt, getRestoredMember, id)
	var i GetRestoredMemberRow
	err := row.Scan(
		&i.ID,
		&i.Email,
		&i.Phone,
		&i.CognitoSub,
		&i.CognitoStatus,
		&i.PreferredAuthMethod,
		&i.PasswordHash,
		&i.LocalAuthEnabled,
		&i.FirstName,
		&i.LastName,
		&i.PhotoUrl,
		&i.StreetAddress,
		&i.City,
		&i.State,
		&i.PostalCode,
		&i.HomeFacilityID,
		&i.IsMember,
		&i.IsStaff,
		&i.DateOfBirth,
		&i.WaiverSigned,
		&i.MembershipLevel,
		&i.StaffRole,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PhotoID,
		&i.CardType,
		&i.CardLastFour,
		&i.BillingAddress,
		&i.BillingCity,
		&i.BillingState,
		&i.BillingPostalCode,
	)
	return i, err
}

const getUpdatedMember = `-- name: GetUpdatedMember :one
SELECT
    u.id, u.email, u.phone, u.cognito_sub, u.cognito_status, u.preferred_auth_method, u.password_hash, u.local_auth_enabled, u.first_name, u.last_name, u.photo_url, u.street_address, u.city, u.state, u.postal_code, u.home_facility_id, u.is_member, u.is_staff, u.date_of_birth, u.waiver_signed, u.membership_level, u.staff_role, u.status, u.created_at, u.updated_at,
    p.id as photo_id,
    ub.card_type,
    ub.card_last_four,
    ub.billing_address,
    ub.billing_city,
    ub.billing_state,
    ub.billing_postal_code
FROM users u
LEFT JOIN user_photos p ON p.user_id = u.id
LEFT JOIN user_billing ub ON ub.user_id = u.id
WHERE u.id = ?1
`

type GetUpdatedMemberRow struct {
	ID                  int64          `json:"id"`
	Email               sql.NullString `json:"email"`
	Phone               sql.NullString `json:"phone"`
	CognitoSub          sql.NullString `json:"cognitoSub"`
	CognitoStatus       sql.NullString `json:"cognitoStatus"`
	PreferredAuthMethod sql.NullString `json:"preferredAuthMethod"`
	PasswordHash        sql.NullString `json:"passwordHash"`
	LocalAuthEnabled    bool           `json:"localAuthEnabled"`
	FirstName           string         `json:"firstName"`
	LastName            string         `json:"lastName"`
	PhotoUrl            sql.NullString `json:"photoUrl"`
	StreetAddress       sql.NullString `json:"streetAddress"`
	City                sql.NullString `json:"city"`
	State               sql.NullString `json:"state"`
	PostalCode          sql.NullString `json:"postalCode"`
	HomeFacilityID      sql.NullInt64  `json:"homeFacilityId"`
	IsMember            bool           `json:"isMember"`
	IsStaff             bool           `json:"isStaff"`
	DateOfBirth         string         `json:"dateOfBirth"`
	WaiverSigned        bool           `json:"waiverSigned"`
	MembershipLevel     int64          `json:"membershipLevel"`
	StaffRole           sql.NullString `json:"staffRole"`
	Status              string         `json:"status"`
	CreatedAt           time.Time      `json:"createdAt"`
	UpdatedAt           time.Time      `json:"updatedAt"`
	PhotoID             sql.NullInt64  `json:"photoId"`
	CardType            sql.NullString `json:"cardType"`
	CardLastFour        sql.NullString `json:"cardLastFour"`
	BillingAddress      sql.NullString `json:"billingAddress"`
	BillingCity         sql.NullString `json:"billingCity"`
	BillingState        sql.NullString `json:"billingState"`
	BillingPostalCode   sql.NullString `json:"billingPostalCode"`
}

func (q *Queries) GetUpdatedMember(ctx context.Context, id int64) (GetUpdatedMemberRow, error) {
	row := q.queryRow(ctx, q.getUpdatedMemberStmt, getUpdatedMember, id)
	var i GetUpdatedMemberRow
	err := row.Scan(
		&i.ID,
		&i.Email,
		&i.Phone,
		&i.CognitoSub,
		&i.CognitoStatus,
		&i.PreferredAuthMethod,
		&i.PasswordHash,
		&i.LocalAuthEnabled,
		&i.FirstName,
		&i.LastName,
		&i.PhotoUrl,
		&i.StreetAddress,
		&i.City,
		&i.State,
		&i.PostalCode,
		&i.HomeFacilityID,
		&i.IsMember,
		&i.IsStaff,
		&i.DateOfBirth,
		&i.WaiverSigned,
		&i.MembershipLevel,
		&i.StaffRole,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PhotoID,
		&i.CardType,
		&i.CardLastFour,
		&i.BillingAddress,
		&i.BillingCity,
		&i.BillingState,
		&i.BillingPostalCode,
	)
	return i, err
}

const listMembers = `-- name: ListMembers :many

SELECT
    u.id, u.email, u.phone, u.cognito_sub, u.cognito_status, u.preferred_auth_method, u.password_hash, u.local_auth_enabled, u.first_name, u.last_name, u.photo_url, u.street_address, u.city, u.state, u.postal_code, u.home_facility_id, u.is_member, u.is_staff, u.date_of_birth, u.waiver_signed, u.membership_level, u.staff_role, u.status, u.created_at, u.updated_at,
    p.id as photo_id,
    ub.card_type,
    ub.card_last_four,
    ub.billing_address,
    ub.billing_city,
    ub.billing_state,
    ub.billing_postal_code
FROM users u
LEFT JOIN user_photos p ON p.user_id = u.id
LEFT JOIN user_billing ub ON ub.user_id = u.id
WHERE u.is_member = 1
    AND u.status <> 'deleted'
    AND (
        ?1 IS NULL
        OR u.home_facility_id = ?1
    )
    AND (
        ?2 IS NULL
        OR u.first_name LIKE '%' || ?2 || '%'
        OR u.last_name LIKE '%' || ?2 || '%'
        OR u.email LIKE '%' || ?2 || '%'
    )
ORDER BY u.last_name, u.first_name
LIMIT ?4 OFFSET ?3
`

type ListMembersParams struct {
	FacilityID interface{} `json:"facilityId"`
	SearchTerm interface{} `json:"searchTerm"`
	Offset     int64       `json:"offset"`
	Limit      int64       `json:"limit"`
}

type ListMembersRow struct {
	ID                  int64          `json:"id"`
	Email               sql.NullString `json:"email"`
	Phone               sql.NullString `json:"phone"`
	CognitoSub          sql.NullString `json:"cognitoSub"`
	CognitoStatus       sql.NullString `json:"cognitoStatus"`
	PreferredAuthMethod sql.NullString `json:"preferredAuthMethod"`
	PasswordHash        sql.NullString `json:"passwordHash"`
	LocalAuthEnabled    bool           `json:"localAuthEnabled"`
	FirstName           string         `json:"firstName"`
	LastName            string         `json:"lastName"`
	PhotoUrl            sql.NullString `json:"photoUrl"`
	StreetAddress       sql.NullString `json:"streetAddress"`
	City                sql.NullString `json:"city"`
	State               sql.NullString `json:"state"`
	PostalCode          sql.NullString `json:"postalCode"`
	HomeFacilityID      sql.NullInt64  `json:"homeFacilityId"`
	IsMember            bool           `json:"isMember"`
	IsStaff             bool           `json:"isStaff"`
	DateOfBirth         string         `json:"dateOfBirth"`
	WaiverSigned        bool           `json:"waiverSigned"`
	MembershipLevel     int64          `json:"membershipLevel"`
	StaffRole           sql.NullString `json:"staffRole"`
	Status              string         `json:"status"`
	CreatedAt           time.Time      `json:"createdAt"`
	UpdatedAt           time.Time      `json:"updatedAt"`
	PhotoID             sql.NullInt64  `json:"photoId"`
	CardType            sql.NullString `json:"cardType"`
	CardLastFour        sql.NullString `json:"cardLastFour"`
	BillingAddress      sql.NullString `json:"billingAddress"`
	BillingCity         sql.NullString `json:"billingCity"`
	BillingState        sql.NullString `json:"billingState"`
	BillingPostalCode   sql.NullString `json:"billingPostalCode"`
}

// internal/db/queries/members.sql
// Queries for users who are members (is_member = 1)
// Uses consolidated users table
func (q *Queries) ListMembers(ctx context.Context, arg ListMembersParams) ([]ListMembersRow, error) {
	rows, err := q.query(ctx, q.listMembersStmt, listMembers,
		arg.FacilityID,
		arg.SearchTerm,
		arg.Offset,
		arg.Limit,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListMembersRow
	for rows.Next() {
		var i ListMembersRow
		if err := rows.Scan(
			&i.ID,
			&i.Email,
			&i.Phone,
			&i.CognitoSub,
			&i.CognitoStatus,
			&i.PreferredAuthMethod,
			&i.PasswordHash,
			&i.LocalAuthEnabled,
			&i.FirstName,
			&i.LastName,
			&i.PhotoUrl,
			&i.StreetAddress,
			&i.City,
			&i.State,
			&i.PostalCode,
			&i.HomeFacilityID,
			&i.IsMember,
			&i.IsStaff,
			&i.DateOfBirth,
			&i.WaiverSigned,
			&i.MembershipLevel,
			&i.StaffRole,
			&i.Status,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.PhotoID,
			&i.CardType,
			&i.CardLastFour,
			&i.BillingAddress,
			&i.BillingCity,
			&i.BillingState,
			&i.BillingPostalCode,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const restoreMember = `-- name: RestoreMember :exec
UPDATE users
SET status = 'active',
    updated_at = CURRENT_TIMESTAMP
WHERE id = ?1 AND is_member = 1
`

func (q *Queries) RestoreMember(ctx context.Context, id int64) error {
	_, err := q.exec(ctx, q.restoreMemberStmt, restoreMember, id)
	return err
}

const searchMembers = `-- name: SearchMembers :many
SELECT
    u.id,
    u.first_name,
    u.last_name,
    u.email
FROM users u
WHERE u.is_member = 1
    AND u.status <> 'deleted'
    AND (
        ?1 IS NULL
        OR u.first_name LIKE '%' || ?1 || '%'
        OR u.last_name LIKE '%' || ?1 || '%'
        OR u.email LIKE '%' || ?1 || '%'
    )
ORDER BY u.last_name, u.first_name
LIMIT ?2
`

type SearchMembersParams struct {
	SearchTerm interface{} `json:"searchTerm"`
	Limit      int64       `json:"limit"`
}

type SearchMembersRow struct {
	ID        int64          `json:"id"`
	FirstName string         `json:"firstName"`
	LastName  string         `json:"lastName"`
	Email     sql.NullString `json:"email"`
}

func (q *Queries) SearchMembers(ctx context.Context, arg SearchMembersParams) ([]SearchMembersRow, error) {
	rows, err := q.query(ctx, q.searchMembersStmt, searchMembers, arg.SearchTerm, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []SearchMembersRow
	for rows.Next() {
		var i SearchMembersRow
		if err := rows.Scan(
			&i.ID,
			&i.FirstName,
			&i.LastName,
			&i.Email,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateBillingInfo = `-- name: UpdateBillingInfo :one
INSERT INTO user_billing (
    user_id, card_last_four, card_type,
    billing_address, billing_city, billing_state, billing_postal_code
) VALUES (
    ?1, ?2, ?3,
    ?4, ?5, ?6, ?7
)
ON CONFLICT(user_id) DO UPDATE SET
    card_last_four = excluded.card_last_four,
    card_type = excluded.card_type,
    billing_address = excluded.billing_address,
    billing_city = excluded.billing_city,
    billing_state = excluded.billing_state,
    billing_postal_code = excluded.billing_postal_code,
    updated_at = CURRENT_TIMESTAMP
RETURNING id, user_id, card_last_four, card_type, billing_address, billing_city, billing_state, billing_postal_code, created_at, updated_at
`

type UpdateBillingInfoParams struct {
	UserID            int64          `json:"userId"`
	CardLastFour      sql.NullString `json:"cardLastFour"`
	CardType          sql.NullString `json:"cardType"`
	BillingAddress    sql.NullString `json:"billingAddress"`
	BillingCity       sql.NullString `json:"billingCity"`
	BillingState      sql.NullString `json:"billingState"`
	BillingPostalCode sql.NullString `json:"billingPostalCode"`
}

func (q *Queries) UpdateBillingInfo(ctx context.Context, arg UpdateBillingInfoParams) (UserBilling, error) {
	row := q.queryRow(ctx, q.updateBillingInfoStmt, updateBillingInfo,
		arg.UserID,
		arg.CardLastFour,
		arg.CardType,
		arg.BillingAddress,
		arg.BillingCity,
		arg.BillingState,
		arg.BillingPostalCode,
	)
	var i UserBilling
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CardLastFour,
		&i.CardType,
		&i.BillingAddress,
		&i.BillingCity,
		&i.BillingState,
		&i.BillingPostalCode,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateMember = `-- name: UpdateMember :exec
UPDATE users
SET first_name = ?1,
    last_name = ?2,
    email = ?3,
    phone = ?4,
    street_address = ?5,
    city = ?6,
    state = ?7,
    postal_code = ?8,
    status = ?9,
    date_of_birth = strftime('%Y-%m-%d', ?10),
    waiver_signed = ?11,
    membership_level = ?12,
    updated_at = CURRENT_TIMESTAMP
WHERE id = ?13 AND is_member = 1
`

type UpdateMemberParams struct {
	FirstName       string         `json:"firstName"`
	LastName        string         `json:"lastName"`
	Email           sql.NullString `json:"email"`
	Phone           sql.NullString `json:"phone"`
	StreetAddress   sql.NullString `json:"streetAddress"`
	City            sql.NullString `json:"city"`
	State           sql.NullString `json:"state"`
	PostalCode      sql.NullString `json:"postalCode"`
	Status          string         `json:"status"`
	DateOfBirth     interface{}    `json:"dateOfBirth"`
	WaiverSigned    bool           `json:"waiverSigned"`
	MembershipLevel int64          `json:"membershipLevel"`
	ID              int64          `json:"id"`
}

func (q *Queries) UpdateMember(ctx context.Context, arg UpdateMemberParams) error {
	_, err := q.exec(ctx, q.updateMemberStmt, updateMember,
		arg.FirstName,
		arg.LastName,
		arg.Email,
		arg.Phone,
		arg.StreetAddress,
		arg.City,
		arg.State,
		arg.PostalCode,
		arg.Status,
		arg.DateOfBirth,
		arg.WaiverSigned,
		arg.MembershipLevel,
		arg.ID,
	)
	return err
}

const updateMemberEmail = `-- name: UpdateMemberEmail :one
UPDATE users
SET email = ?1,
    updated_at = CURRENT_TIMESTAMP
WHERE id = ?2 AND is_member = 1
RETURNING id, email, phone, cognito_sub, cognito_status, preferred_auth_method, password_hash, local_auth_enabled, first_name, last_name, photo_url, street_address, city, state, postal_code, home_facility_id, is_member, is_staff, date_of_birth, waiver_signed, membership_level, staff_role, status, created_at, updated_at
`

type UpdateMemberEmailParams struct {
	Email sql.NullString `json:"email"`
	ID    int64          `json:"id"`
}

func (q *Queries) UpdateMemberEmail(ctx context.Context, arg UpdateMemberEmailParams) (User, error) {
	row := q.queryRow(ctx, q.updateMemberEmailStmt, updateMemberEmail, arg.Email, arg.ID)
	var i User
	err := row.Scan(
		&i.ID,
		&i.Email,
		&i.Phone,
		&i.CognitoSub,
		&i.CognitoStatus,
		&i.PreferredAuthMethod,
		&i.PasswordHash,
		&i.LocalAuthEnabled,
		&i.FirstName,
		&i.LastName,
		&i.PhotoUrl,
		&i.StreetAddress,
		&i.City,
		&i.State,
		&i.PostalCode,
		&i.HomeFacilityID,
		&i.IsMember,
		&i.IsStaff,
		&i.DateOfBirth,
		&i.WaiverSigned,
		&i.MembershipLevel,
		&i.StaffRole,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const upsertPhoto = `-- name: UpsertPhoto :one
INSERT INTO user_photos (user_id, data, content_type, size)
VALUES (?1, ?2, ?3, ?4)
ON CONFLICT(user_id) DO UPDATE SET
    data = excluded.data,
    content_type = excluded.content_type,
    size = excluded.size,
    updated_at = CURRENT_TIMESTAMP
RETURNING id, user_id, data, content_type, size, created_at, updated_at
`

type UpsertPhotoParams struct {
	UserID      int64  `json:"userId"`
	Data        []byte `json:"data"`
	ContentType string `json:"contentType"`
	Size        int64  `json:"size"`
}

func (q *Queries) UpsertPhoto(ctx context.Context, arg UpsertPhotoParams) (UserPhoto, error) {
	row := q.queryRow(ctx, q.upsertPhotoStmt, upsertPhoto,
		arg.UserID,
		arg.Data,
		arg.ContentType,
		arg.Size,
	)
	var i UserPhoto
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.Data,
		&i.ContentType,
		&i.Size,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
